---
title: "Player Data Prep"
author: "Xavier Genelin"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(nflverse)
library(fst)
```


```{r seasons}
start_season <- 2015
```

# Weekly Data

```{r player_weekly}
player_weekly <- load_player_stats(seasons = c(start_season:most_recent_season()), stat_type = "offense") %>%
  filter(season_type == "REG") %>%
  filter(position_group %in% c("QB", "RB", "TE", "WR")) %>%
  mutate(position = ifelse(str_trim(position) == "HB", "RB", position))

player_weekly
```


```{r}
player_weekly %>%
  select(position) %>%
  distinct()
```


# Season

```{r player_season}
player_season <- player_weekly %>%
  group_by(player_id, player_display_name, season, position, headshot_url) %>%
  summarise(completions = sum(completions),
            attempts = sum(attempts),
            passing_yards = sum(passing_yards),
            passing_tds = sum(passing_tds),
            interceptions = sum(interceptions),
            sacks = sum(sacks),
            sack_yards = sum(sack_yards),
            sack_fumbles = sum(sack_fumbles),
            sack_fumbles_lost = sum(sack_fumbles_lost),
            passing_yards_after_catch = sum(passing_yards_after_catch),
            passing_first_downs = sum(passing_first_downs),
            passing_2pt_conversions = sum(passing_2pt_conversions),
            carries = sum(carries),
            rushing_yards = sum(rushing_yards),
            rushing_tds = sum(rushing_tds),
            rushing_fumbles = sum(rushing_fumbles),
            rushing_fumbles_lost = sum(rushing_fumbles_lost),
            rushing_first_downs = sum(rushing_first_downs),
            rushing_2pt_conversions = sum(rushing_2pt_conversions),
            receptions = sum(receptions),
            targets = sum(targets),
            receiving_yards = sum(receiving_yards),
            receiving_tds = sum(receiving_tds),
            receiving_fumbles = sum(receiving_fumbles),
            receiving_fumbles_lost = sum(receiving_fumbles_lost),
            receiving_air_yards = sum(receiving_air_yards),
            receiving_yards_after_catch = sum(receiving_yards_after_catch),
            receiving_first_downs = sum(receiving_first_downs),
            receiving_2pt_conversions = sum(),
            special_teams_tds = sum(special_teams_tds),
            fantasy_points = sum(fantasy_points),
            fantasy_points_ppr = sum(fantasy_points_ppr))

player_season
```

# Save to fst files

```{r player_fsts}
write.fst(player_season, "data/player_season.fst")
write.fst(player_weekly, "data/player_weekly.fst")
```